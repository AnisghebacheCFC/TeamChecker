<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Team Search</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <div class="bug-report-icon">
            <a href="mailto:aghebache@cfc.com?subject=Bug%20Report&body=Hello%20Anis,%20the%20bug%20is%20as%20follows:">
                <img src="bug-icon.png" alt="Report a bug" title="Report a bug" class="bug-icon">
            </a>
        </div>
        <img src="cfc-logo.png" alt="CFC Underwriting Logo" class="logo">
    </div>
    <div id="policyContainer" class="container">
        <h1>Policy Number Check</h1>
        <input type="text" id="policyNumber" placeholder="Enter policy number">
        <div id="policyResultBox"></div>
    </div>
    
    <!-- New Email Subject Analyzer Section -->
    <div class="container" id="analyzerContainer">
        <h1>Email Subject Analyzer (Under Construction)2</h1>
        <input type="text" id="emailSubject" placeholder="Enter email subject">
        <div class="center">
            <button id="analyzeButton">Analyze</button>
        </div>
        <div id="analyzeResult"></div>
    </div>
    
    <div class="container">
        <h1>Insurance Team Search</h1>
        <input type="text" id="searchBox" placeholder="Enter an activity">
        <div id="suggestions"></div>
        <div class="center">
            <button id="searchButton">Search</button>
        </div>
        <div id="resultBox"></div>
        <div id="listsWrapper">
            <div id="keywordsList" class="list"></div>
            <div id="avoidList" class="list"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
    <script>
document.addEventListener('DOMContentLoaded', (event) => {
    const analyzeButton = document.getElementById('analyzeButton');
    if (analyzeButton) {
        analyzeButton.addEventListener('click', function() {
            let subject = document.getElementById('emailSubject').value.toLowerCase();

            // Normalize subject
            subject = subject.normalize('NFD').replace(/[\u0300-\u036f]/g, ''); // Remove accents
            subject = subject.replace(/\//g, ' or '); // Replace "/" with "or"
            subject = subject.replace(/[^\w\s]/gi, ''); // Remove special characters

            const analyzeResult = document.getElementById('analyzeResult');

            // Clear previous results
            analyzeResult.innerHTML = '';

            // Reject if "bind" is included
            if (subject.includes('bind')) {
                analyzeResult.innerHTML = 'REJECT';
                return;
            }

            const keywords = {
                // Define your keywords as before
            };

            const abbreviations = {
                // Define your abbreviations as before
            };

            let foundCategories = new Set();
            let foundKeywords = new Set();

            // Create a combined list of keywords and abbreviations for fuzzy searching
            const combinedKeywords = [];
            for (let category in keywords) {
                combinedKeywords.push(...keywords[category].map(word => ({ word, category })));
            }
            const combinedAbbreviations = [];
            for (let abbr in abbreviations) {
                combinedAbbreviations.push({ word: abbr, category: abbreviations[abbr] });
            }

            // Fuse.js options for fuzzy matching (keywords)
            const fuseOptionsKeywords = {
                keys: ['word'],
                threshold: 0.6, // Adjusted to be less strict
                distance: 200 // Adjusted to be less strict
            };

            // Fuse.js options for fuzzy matching (abbreviations)
            const fuseOptionsAbbreviations = {
                keys: ['word'],
                threshold: 0.6, // Adjusted to be less strict
                distance: 200 // Adjusted to be less strict
            };

            const fuseKeywords = new Fuse(combinedKeywords, fuseOptionsKeywords);
            const fuseAbbreviations = new Fuse(combinedAbbreviations, fuseOptionsAbbreviations);

            // Normalize and split subject into words
            let words = subject.split(/\s+/);

            // Check each word using Fuse.js for full keywords
            words.forEach(word => {
                let result = fuseKeywords.search(word);
                if (result.length > 0) {
                    let bestMatch = result[0].item;
                    // Consider a match only if the similarity score is below a certain threshold
                    if (result[0].score < 0.6) {
                        foundKeywords.add(bestMatch.word);
                        if (bestMatch.category) {
                            foundCategories.add(bestMatch.category);
                        }
                    }
                }
            });

            // Check each word using Fuse.js for abbreviations
            words.forEach(word => {
                let result = fuseAbbreviations.search(word);
                if (result.length > 0) {
                    let bestMatch = result[0].item;
                    // Consider a match only if the similarity score is below a certain threshold
                    if (result[0].score < 0.6) {
                        foundKeywords.add(bestMatch.word);
                        if (bestMatch.category) {
                            foundCategories.add(bestMatch.category);
                        }
                    }
                }
            });

            // Convert sets to arrays and remove duplicates of acronyms and full forms
            let uniqueKeywords = Array.from(foundKeywords);
            let finalKeywords = [];
            uniqueKeywords.forEach((keyword, index) => {
                let cleanKeyword = keyword.toLowerCase().replace(/[&\s]/g, '');
                if (!uniqueKeywords.slice(index + 1).some(k => k.toLowerCase().replace(/[&\s]/g, '') === cleanKeyword)) {
                    finalKeywords.push(keyword);
                }
            });

            let categoriesArray = Array.from(foundCategories);
            analyzeResult.innerHTML = `Categories: ${categoriesArray.length > 0 ? categoriesArray.join(', ') : 'None'}<br>Keywords Found: ${finalKeywords.length > 0 ? finalKeywords.join(', ') : 'None'}`;
        });
    }
});

    </script>
</body>
</html>
